<!DOCTYPE html>
<html>

<head>
	<title> Home </title>
	<link rel="stylesheet" href="../static/main.css" />
</head>

<body>
	<h1> Home </h1>
	<p>
		<b> Welcome </b> to <i> Cozy Caf√©s</i>!
	</p>

	{% if session %}
		<p> Signed in on user {{ session["uname"] }} </p>
		<p>
			<a href="/logout"> Logout </a> |
			<a href="/profile/{{ session.id }}"> Profile </a>
		</p>

		<form method="get">
			<button type="submit" formaction="/add_item"> Add review </button>
			<button type="submit" formaction="/search"> Search reviews </button>
		</form>
	{% else %}
		<p>
			<a href="/create"> Create account </a> |
			<a href="/login"> Login </a>
		</p>

		<form method="get">
			<button type="submit" formaction="/search"> Search reviews </button>
		</form>
	{% endif %}

	{% with messages = get_flashed_messages() %}
		{% if messages %}
			<p><em> {{ messages[0] }} </em></p>
		{% endif %}
	{% endwith %}

	<hr />

	<h2> Reviews </h2>

	<div class="review-container">

		{% for r in reviews %}
			<div class="review">
				<p class="uname"><a href="/profile/{{ r['user']}}"> {{ r['username'] }} </a></p>
				<p class="time"> {{ r['date_created']}} </p>

				{% if r['date_edited'] %}
					<p class="time"> Last edited: {{ r['date_edited'] }} </p>
				{% endif %}

				<hr />

				<p> Rating: {{ r['rating'] }}/5 </p>
				<p class="cafe"> {{ r['cafe'] }} </p>

				{% if r['review_text'] %}
					<div class="text">{{ r['review_text'] }}</div>
				{% endif %}

				<div class="categories">
					{% if r['categories'] %}
						{% for cat in r['categories'] %}
							<p class="category"> {{ cat }} </p>
						{% endfor %}
					{% endif %}
				</div>

				<a href="/comments/{{ r['id'] }}"> Comments ({{ r['count'] }})</a>

				{% if session['id'] == r['user'] %}
					| <a href="/edit_item/{{ r['id'] }}"> Edit </a>
				{% endif %}
			</div>
		{% else %}
			<p> No reviews yet </p>
		{% endfor %}

	</div>
</body>

</html>